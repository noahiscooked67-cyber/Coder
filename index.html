<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hack.io // UltraWide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #0D0D0D;
            --bg-sidebar: #000000;
            --text-primary: #FFFFFF;
            --text-dim: #B4B4B4;
            --input-bg: #161616;
            --border: #262626;
        }

        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg-main); color: var(--text-primary); font-family: 'Inter', sans-serif; overflow: hidden; }

        .app-wrapper {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100vh;
            width: 100vw;
        }

        /* --- SIDEBAR --- */
        #sidebar { background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; overflow: hidden; z-index: 10; }
        .logo { font-family: 'Orbitron'; font-size: 20px; padding: 20px; letter-spacing: 3px; text-align: center; }
        .new-chat-btn { background: #fff; color: #000; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 20px; font-family: 'Orbitron'; font-size: 11px; }

        #history-list { flex: 1; overflow-y: auto; }
        .history-item { padding: 12px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; border: 1px solid transparent; }
        .history-item:hover { background: #111; }
        .history-item.active { background: #161616; border-color: var(--border); }
        .item-actions { display: flex; gap: 8px; opacity: 0; }
        .history-item:hover .item-actions { opacity: 1; }
        .action-btn { cursor: pointer; color: var(--text-dim); }

        /* --- MAIN VIEW --- */
        #main-container { display: flex; flex-direction: column; background: var(--bg-main); overflow: hidden; width: 100%; position: relative; }
        #chat-window { flex: 1; overflow-y: auto; width: 100%; scroll-behavior: smooth; }
        #empty-state { flex: 1; display: flex; align-items: center; justify-content: center; opacity: 0.3; }

        .message-row { width: 100%; display: flex; padding: 30px 0; border-bottom: 1px solid #141414; }
        .message-content { width: 100%; padding: 0 40px; display: flex; gap: 25px; box-sizing: border-box; flex-direction: column; }
        .msg-header { display: flex; gap: 25px; align-items: flex-start; }
        
        .txt { flex: 1; line-height: 1.8; font-size: 16px; word-wrap: break-word; min-width: 0; }
        .avatar { width: 40px; height: 40px; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-family: 'Orbitron'; font-size: 12px; border: 1px solid #333; }
        .ai-avatar { background: #fff; color: #000; border-color: #fff; }

        /* --- FILE UI --- */
        .file-attachment { background: #1A1A1A; border: 1px solid var(--border); border-radius: 10px; padding: 12px 20px; display: flex; align-items: center; gap: 15px; margin-top: 10px; max-width: 400px; }
        .staged-file { background: #222; border: 1px solid #444; padding: 8px 15px; border-radius: 8px; display: none; align-items: center; gap: 10px; margin-bottom: 10px; width: fit-content; font-size: 13px; }
        .remove-file { cursor: pointer; color: #ff4b4b; font-weight: bold; }

        /* --- INPUT --- */
        #input-container { padding: 25px 40px; background: #000; width: 100%; box-sizing: border-box; }
        .search-bar { width: 100%; background: var(--input-bg); border: 1px solid var(--border); border-radius: 12px; display: flex; align-items: center; padding: 15px 25px; gap: 20px; }
        input[type="text"] { flex: 1; background: transparent; border: none; color: #fff; font-size: 18px; outline: none; }
        .send-btn { background: #fff !important; color: #000 !important; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border: none; }

        /* --- DROP OVERLAY --- */
        #drop-zone { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(255, 255, 255, 0.05); border: 4px dashed #fff; display: none; align-items: center; justify-content: center; z-index: 9999; pointer-events: none; }
        body.dragging #drop-zone { display: flex; }
    </style>
</head>
<body ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">

    <div id="drop-zone"><h2 style="font-family:'Orbitron'; background:#000; padding:20px; border-radius:10px;">DROP FILE</h2></div>

    <div class="app-wrapper">
        <div id="sidebar">
            <div class="logo">HACK.IO</div>
            <button class="new-chat-btn" onclick="createNewSession()">+ NEW SESSION</button>
            <div id="history-list"></div>
        </div>

        <div id="main-container">
            <div id="empty-state"><h1 style="font-family:'Orbitron'; font-size:40px; letter-spacing:15px;">HACK.IO</h1></div>
            <div id="chat-window" style="display:none;"></div>
            <div id="input-container">
                <div id="file-preview-area" class="staged-file">
                    <span>ðŸ“„</span> <span id="staged-filename"></span> 
                    <span class="remove-file" onclick="clearStagedFile()">âœ•</span>
                </div>
                <div class="search-bar">
                    <input type="text" id="user-input" placeholder="Message or drop file..." onkeypress="if(event.key==='Enter') handleSend()">
                    <button class="send-btn" onclick="handleSend()">â†‘</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "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";
        let sessions = JSON.parse(localStorage.getItem('hackio_clean_v1') || '{}');
        let activeId = null;
        let stagedFile = null;

        function save() { localStorage.setItem('hackio_clean_v1', JSON.stringify(sessions)); refreshSidebar(); }

        function handleDragOver(e) { e.preventDefault(); document.body.classList.add('dragging'); }
        function handleDragLeave(e) { if (e.relatedTarget === null) document.body.classList.remove('dragging'); }
        function handleDrop(e) {
            e.preventDefault();
            document.body.classList.remove('dragging');
            const file = e.dataTransfer.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    stagedFile = { name: file.name, size: (file.size / 1024).toFixed(1) + ' KB', content: event.target.result };
                    document.getElementById('file-preview-area').style.display = 'flex';
                    document.getElementById('staged-filename').innerText = file.name;
                };
                reader.readAsText(file);
            }
        }

        function clearStagedFile() { stagedFile = null; document.getElementById('file-preview-area').style.display = 'none'; }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const val = input.value.trim();
            if (!val && !stagedFile) return;
            if (!activeId) createNewSession();

            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('chat-window').style.display = 'block';

            renderMsg(val || "File analysis", 'USER', true, stagedFile);
            const context = stagedFile ? `[FILE: ${stagedFile.name}]\nContent: ${stagedFile.content}\n\nUser: ${val}` : val;
            
            input.value = '';
            clearStagedFile();
            const aiBox = renderMsg('...', 'AI');
            await streamAI(context, aiBox);
        }

        function cleanText(t) {
            return t.replace(/[,*]/g, '');
        }

        async function streamAI(prompt, element) {
            let fullText = "";
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "google/gemini-2.0-flash-001",
                    messages: [{role: "user", content: prompt}],
                    stream: true
                })
            });

            const reader = response.body.getReader();
            while (true) {
                const {done, value} = await reader.read();
                if (done) break;
                const chunk = new TextDecoder().decode(value);
                const lines = chunk.split('\n');
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        const data = line.replace('data: ', '');
                        if (data === '[DONE]') break;
                        try {
                            const raw = JSON.parse(data).choices[0].delta.content || "";
                            fullText += raw;
                            element.innerText = cleanText(fullText);
                            const win = document.getElementById('chat-window');
                            if (win.scrollHeight - win.scrollTop - win.clientHeight < 200) win.scrollTop = win.scrollHeight;
                        } catch(e){}
                    }
                }
            }
            sessions[activeId].messages.push({text: cleanText(fullText), sender: 'AI'});
            save();
        }

        function renderMsg(text, sender, push = true, fileObj = null) {
            const win = document.getElementById('chat-window');
            const isAi = sender === 'AI';
            const row = document.createElement('div');
            row.className = 'message-row';
            
            let fileHtml = fileObj ? `
                <div class="file-attachment">
                    <div>ðŸ“„</div>
                    <div><div style="font-weight:600">${fileObj.name}</div><div style="font-size:11px;color:#888">${fileObj.size}</div></div>
                </div>` : "";

            row.innerHTML = `
                <div class="message-content">
                    <div class="msg-header">
                        <div class="avatar ${isAi ? 'ai-avatar' : ''}">${isAi ? 'AI' : 'U'}</div>
                        <div class="txt">${text}</div>
                    </div>
                    ${fileHtml}
                </div>`;
            
            win.appendChild(row);
            win.scrollTop = win.scrollHeight;
            if (push && sender === 'USER') sessions[activeId].messages.push({text, sender, file: fileObj});
            return row.querySelector('.txt');
        }

        function createNewSession() { activeId = 'S_' + Date.now(); sessions[activeId] = { name: "New Session", messages: [] }; save(); loadSess(activeId); }
        function refreshSidebar() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            Object.keys(sessions).reverse().forEach(id => {
                const item = document.createElement('div');
                item.className = `history-item ${id === activeId ? 'active' : ''}`;
                item.innerHTML = `<span style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${sessions[id].name}</span>
                    <div class="item-actions"><span class="action-btn" onclick="renameSess('${id}', event)">âœŽ</span>
                    <span class="action-btn" onclick="deleteSess('${id}', event)">âœ•</span></div>`;
                item.onclick = () => loadSess(id);
                list.appendChild(item);
            });
        }
        function loadSess(id) {
            activeId = id;
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('chat-window').style.display = 'block';
            document.getElementById('chat-window').innerHTML = '';
            sessions[id].messages.forEach(m => renderMsg(m.text, m.sender, false, m.file));
            refreshSidebar();
        }
        function renameSess(id, e) { e.stopPropagation(); const n = prompt("Rename:", sessions[id].name); if(n) { sessions[id].name = n; save(); } }
        function deleteSess(id, e) { e.stopPropagation(); if(confirm("Delete?")) { delete sessions[id]; if (activeId === id) activeId = null; save(); location.reload(); } }
        refreshSidebar();
    </script>
</body>
</html>
